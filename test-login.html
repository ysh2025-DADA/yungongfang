<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>登录功能测试</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body class="bg-gray-50">
    <div class="max-w-4xl mx-auto px-4 py-8">
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-900 mb-2">登录功能测试</h1>
            <p class="text-gray-600">测试管理员添加的用户账号登录功能</p>
        </div>

        <!-- 当前用户信息 -->
        <div class="bg-white rounded-lg shadow-sm border p-6 mb-6">
            <h2 class="text-xl font-semibold text-gray-900 mb-4">当前登录用户</h2>
            <div id="current-user-info" class="text-gray-600">
                未登录
            </div>
        </div>

        <!-- 用户列表 -->
        <div class="bg-white rounded-lg shadow-sm border p-6 mb-6">
            <h2 class="text-xl font-semibold text-gray-900 mb-4">localStorage中的用户数据</h2>
            <div id="users-list" class="space-y-2">
                <!-- 用户列表将通过JavaScript动态生成 -->
            </div>
        </div>

        <!-- 测试登录 -->
        <div class="bg-white rounded-lg shadow-sm border p-6 mb-6">
            <h2 class="text-xl font-semibold text-gray-900 mb-4">测试登录</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="border border-gray-200 rounded-lg p-4">
                    <h3 class="text-lg font-medium text-gray-900 mb-2">学生登录</h3>
                    <div class="space-y-2">
                        <input type="text" id="student-username" placeholder="用户名" class="w-full border border-gray-300 rounded px-3 py-2 text-sm">
                        <input type="password" id="student-password" placeholder="密码" class="w-full border border-gray-300 rounded px-3 py-2 text-sm">
                        <button onclick="testStudentLogin()" class="w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded text-sm transition-colors">
                            测试学生登录
                        </button>
                    </div>
                </div>

                <div class="border border-gray-200 rounded-lg p-4">
                    <h3 class="text-lg font-medium text-gray-900 mb-2">教师登录</h3>
                    <div class="space-y-2">
                        <input type="text" id="teacher-username" placeholder="用户名" class="w-full border border-gray-300 rounded px-3 py-2 text-sm">
                        <input type="password" id="teacher-password" placeholder="密码" class="w-full border border-gray-300 rounded px-3 py-2 text-sm">
                        <button onclick="testTeacherLogin()" class="w-full bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded text-sm transition-colors">
                            测试教师登录
                        </button>
                    </div>
                </div>

                <div class="border border-gray-200 rounded-lg p-4">
                    <h3 class="text-lg font-medium text-gray-900 mb-2">管理员登录</h3>
                    <div class="space-y-2">
                        <input type="text" id="admin-username" placeholder="用户名" class="w-full border border-gray-300 rounded px-3 py-2 text-sm">
                        <input type="password" id="admin-password" placeholder="密码" class="w-full border border-gray-300 rounded px-3 py-2 text-sm">
                        <button onclick="testAdminLogin()" class="w-full bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded text-sm transition-colors">
                            测试管理员登录
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 操作按钮 -->
        <div class="bg-white rounded-lg shadow-sm border p-6">
            <h2 class="text-xl font-semibold text-gray-900 mb-4">操作</h2>
            <div class="flex space-x-4">
                <button onclick="refreshData()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded text-sm transition-colors">
                    刷新数据
                </button>
                <button onclick="clearSession()" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded text-sm transition-colors">
                    清除登录状态
                </button>
                <button onclick="window.location.href='index.html'" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded text-sm transition-colors">
                    返回登录页面
                </button>
                <button onclick="window.location.href='navigation.html'" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded text-sm transition-colors">
                    导航中心
                </button>
            </div>
        </div>
    </div>

    <script>
        // 初始化Lucide图标
        lucide.createIcons();

        // 从localStorage加载用户数据
        function loadUsers() {
            const savedUsers = localStorage.getItem('admin_users');
            if (savedUsers) {
                return JSON.parse(savedUsers);
            }
            return [];
        }

        // 显示当前用户信息
        function showCurrentUser() {
            const currentUser = sessionStorage.getItem('currentUser');
            const userInfoDiv = document.getElementById('current-user-info');
            
            if (currentUser) {
                const user = JSON.parse(currentUser);
                userInfoDiv.innerHTML = `
                    <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                        <div class="flex items-center space-x-3">
                            <div class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center">
                                <span class="text-sm font-medium text-green-600">${user.realName ? user.realName.charAt(0) : user.username.charAt(0)}</span>
                            </div>
                            <div>
                                <p class="text-sm font-medium text-green-800">${user.realName || user.username}</p>
                                <p class="text-xs text-green-600">角色：${user.role === 'student' ? '学生' : user.role === 'teacher' ? '教师' : '管理员'}</p>
                                <p class="text-xs text-green-600">邮箱：${user.email || '无'}</p>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                userInfoDiv.innerHTML = `
                    <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                        <p class="text-gray-600">未登录</p>
                    </div>
                `;
            }
        }

        // 显示用户列表
        function showUsersList() {
            const users = loadUsers();
            const usersListDiv = document.getElementById('users-list');
            
            if (users.length === 0) {
                usersListDiv.innerHTML = '<p class="text-gray-500">暂无用户数据</p>';
                return;
            }
            
            usersListDiv.innerHTML = users.map(user => `
                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                    <div class="flex items-center space-x-3">
                        <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
                            <span class="text-xs font-medium text-blue-600">${user.realName ? user.realName.charAt(0) : user.username.charAt(0)}</span>
                        </div>
                        <div>
                            <p class="text-sm font-medium text-gray-900">${user.realName || user.username}</p>
                            <p class="text-xs text-gray-500">用户名：${user.username}</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-2">
                        <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full ${
                            user.role === 'student' ? 'bg-blue-100 text-blue-800' :
                            user.role === 'teacher' ? 'bg-green-100 text-green-800' :
                            'bg-purple-100 text-purple-800'
                        }">
                            ${user.role === 'student' ? '学生' : user.role === 'teacher' ? '教师' : '管理员'}
                        </span>
                        <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full ${
                            user.status === 'active' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'
                        }">
                            ${user.status === 'active' ? '正常' : '禁用'}
                        </span>
                    </div>
                </div>
            `).join('');
        }

        // 测试学生登录
        function testStudentLogin() {
            const username = document.getElementById('student-username').value;
            const password = document.getElementById('student-password').value;
            
            if (!username || !password) {
                alert('请输入用户名和密码');
                return;
            }
            
            const users = loadUsers();
            const student = users.find(user => 
                user.username === username && 
                user.password === password && 
                user.role === 'student' && 
                user.status === 'active'
            );
            
            if (student) {
                sessionStorage.setItem('currentUser', JSON.stringify(student));
                alert('✅ 学生登录成功！');
                refreshData();
            } else {
                alert('❌ 学生登录失败！请检查用户名和密码');
            }
        }

        // 测试教师登录
        function testTeacherLogin() {
            const username = document.getElementById('teacher-username').value;
            const password = document.getElementById('teacher-password').value;
            
            if (!username || !password) {
                alert('请输入用户名和密码');
                return;
            }
            
            const users = loadUsers();
            const teacher = users.find(user => 
                user.username === username && 
                user.password === password && 
                user.role === 'teacher' && 
                user.status === 'active'
            );
            
            if (teacher) {
                sessionStorage.setItem('currentUser', JSON.stringify(teacher));
                alert('✅ 教师登录成功！');
                refreshData();
            } else {
                alert('❌ 教师登录失败！请检查用户名和密码');
            }
        }

        // 测试管理员登录
        function testAdminLogin() {
            const username = document.getElementById('admin-username').value;
            const password = document.getElementById('admin-password').value;
            
            if (!username || !password) {
                alert('请输入用户名和密码');
                return;
            }
            
            if (username === '18072830839' && password === 'ysh938798') {
                const adminUser = {
                    id: 1,
                    username: username,
                    realName: '系统管理员',
                    email: 'admin@system.com',
                    role: 'admin',
                    status: 'active'
                };
                sessionStorage.setItem('currentUser', JSON.stringify(adminUser));
                alert('✅ 管理员登录成功！');
                refreshData();
            } else {
                alert('❌ 管理员登录失败！请检查用户名和密码');
            }
        }

        // 刷新数据
        function refreshData() {
            showCurrentUser();
            showUsersList();
        }

        // 清除登录状态
        function clearSession() {
            sessionStorage.removeItem('currentUser');
            alert('登录状态已清除');
            refreshData();
        }

        // 页面加载时初始化
        document.addEventListener('DOMContentLoaded', function() {
            refreshData();
        });
    </script>
</body>
</html> 