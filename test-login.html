<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>云工坊 - 登录测试</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="max-w-4xl mx-auto p-8">
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-900 mb-4">云工坊 - 登录功能测试</h1>
            <p class="text-gray-600">测试各种登录场景，确保系统正常工作</p>
        </div>

        <!-- 测试账号信息 -->
        <div class="bg-white rounded-lg shadow-sm border p-6 mb-8">
            <h2 class="text-xl font-semibold text-gray-900 mb-4">📋 可用测试账号</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="p-4 bg-blue-50 rounded-lg border border-blue-200">
                    <h3 class="font-medium text-blue-900 mb-2">👨‍💼 管理员</h3>
                    <div class="text-sm text-blue-700 space-y-1">
                        <div><strong>用户名：</strong>18072830839</div>
                        <div><strong>密码：</strong>ysh938798</div>
                        <div><strong>权限：</strong>系统管理</div>
                    </div>
                </div>
                <div class="p-4 bg-green-50 rounded-lg border border-green-200">
                    <h3 class="font-medium text-green-900 mb-2">👨‍🎓 学生账号</h3>
                    <div class="text-sm text-green-700 space-y-1">
                        <div><strong>账号1：</strong>student1 / 123456 (张三)</div>
                        <div><strong>账号2：</strong>student2 / 123456 (李四)</div>
                        <div><strong>权限：</strong>学习管理</div>
                    </div>
                </div>
                <div class="p-4 bg-purple-50 rounded-lg border border-purple-200">
                    <h3 class="font-medium text-purple-900 mb-2">👨‍🏫 教师账号</h3>
                    <div class="text-sm text-purple-700 space-y-1">
                        <div><strong>账号1：</strong>teacher1 / 123456 (王老师)</div>
                        <div><strong>账号2：</strong>teacher2 / 123456 (李老师)</div>
                        <div><strong>权限：</strong>教学管理</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 快速登录测试 -->
        <div class="bg-white rounded-lg shadow-sm border p-6 mb-8">
            <h2 class="text-xl font-semibold text-gray-900 mb-4">⚡ 快速登录测试</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <button onclick="testLogin('admin', '18072830839', 'ysh938798')" class="p-4 bg-purple-100 hover:bg-purple-200 rounded-lg border border-purple-300 transition-colors">
                    <div class="text-center">
                        <i data-lucide="shield" class="h-8 w-8 text-purple-600 mx-auto mb-2"></i>
                        <div class="font-medium text-purple-900">管理员登录</div>
                        <div class="text-sm text-purple-700">18072830839</div>
                    </div>
                </button>
                <button onclick="testLogin('student', 'student1', '123456')" class="p-4 bg-blue-100 hover:bg-blue-200 rounded-lg border border-blue-300 transition-colors">
                    <div class="text-center">
                        <i data-lucide="graduation-cap" class="h-8 w-8 text-blue-600 mx-auto mb-2"></i>
                        <div class="font-medium text-blue-900">学生登录</div>
                        <div class="text-sm text-blue-700">student1 (张三)</div>
                    </div>
                </button>
                <button onclick="testLogin('teacher', 'teacher1', '123456')" class="p-4 bg-green-100 hover:bg-green-200 rounded-lg border border-green-300 transition-colors">
                    <div class="text-center">
                        <i data-lucide="book-open" class="h-8 w-8 text-green-600 mx-auto mb-2"></i>
                        <div class="font-medium text-green-900">教师登录</div>
                        <div class="text-sm text-green-700">teacher1 (王老师)</div>
                    </div>
                </button>
            </div>
        </div>

        <!-- 系统状态检查 -->
        <div class="bg-white rounded-lg shadow-sm border p-6 mb-8">
            <h2 class="text-xl font-semibold text-gray-900 mb-4">🔍 系统状态检查</h2>
            <div class="space-y-4">
                <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                    <div>
                        <div class="font-medium text-gray-900">localStorage 状态</div>
                        <div class="text-sm text-gray-600">检查用户数据存储</div>
                    </div>
                    <button onclick="checkLocalStorage()" class="px-4 py-2 bg-blue-600 text-white rounded-lg text-sm hover:bg-blue-700">
                        检查
                    </button>
                </div>
                <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                    <div>
                        <div class="font-medium text-gray-900">sessionStorage 状态</div>
                        <div class="text-sm text-gray-600">检查当前登录状态</div>
                    </div>
                    <button onclick="checkSessionStorage()" class="px-4 py-2 bg-green-600 text-white rounded-lg text-sm hover:bg-green-700">
                        检查
                    </button>
                </div>
                <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                    <div>
                        <div class="font-medium text-gray-900">清除所有数据</div>
                        <div class="text-sm text-gray-600">重置系统到初始状态</div>
                    </div>
                    <button onclick="clearAllData()" class="px-4 py-2 bg-red-600 text-white rounded-lg text-sm hover:bg-red-700">
                        清除
                    </button>
                </div>
            </div>
        </div>

        <!-- 测试结果 -->
        <div class="bg-white rounded-lg shadow-sm border p-6">
            <h2 class="text-xl font-semibold text-gray-900 mb-4">📊 测试结果</h2>
            <div id="test-results" class="space-y-2">
                <div class="text-gray-500">点击上方按钮开始测试...</div>
            </div>
        </div>

        <!-- 返回按钮 -->
        <div class="text-center mt-8">
            <a href="index.html" class="inline-flex items-center px-6 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors">
                <i data-lucide="arrow-left" class="h-5 w-5 mr-2"></i>
                返回登录页面
            </a>
        </div>
    </div>

    <script>
        // 初始化Lucide图标
        lucide.createIcons();

        // 添加测试结果
        function addTestResult(message, type = 'info') {
            const resultsDiv = document.getElementById('test-results');
            const colors = {
                success: 'text-green-700 bg-green-50 border-green-200',
                error: 'text-red-700 bg-red-50 border-red-200',
                info: 'text-blue-700 bg-blue-50 border-blue-200',
                warning: 'text-yellow-700 bg-yellow-50 border-yellow-200'
            };
            
            const resultDiv = document.createElement('div');
            resultDiv.className = `p-3 rounded-lg border ${colors[type]}`;
            resultDiv.innerHTML = `
                <div class="flex items-center">
                    <span class="mr-2">${new Date().toLocaleTimeString()}</span>
                    <span>${message}</span>
                </div>
            `;
            
            resultsDiv.insertBefore(resultDiv, resultsDiv.firstChild);
            
            // 限制显示结果数量
            if (resultsDiv.children.length > 10) {
                resultsDiv.removeChild(resultsDiv.lastChild);
            }
        }

        // 测试登录功能
        function testLogin(role, username, password) {
            addTestResult(`开始测试 ${role} 登录: ${username}`, 'info');
            
            // 模拟登录验证
            setTimeout(() => {
                if (role === 'admin') {
                    if (username === '18072830839' && password === 'ysh938798') {
                        addTestResult(`✅ 管理员登录成功: ${username}`, 'success');
                        // 保存登录状态
                        const adminUser = {
                            id: 1,
                            username: username,
                            realName: '系统管理员',
                            email: 'admin@system.com',
                            role: 'admin',
                            status: 'active'
                        };
                        sessionStorage.setItem('currentUser', JSON.stringify(adminUser));
                    } else {
                        addTestResult(`❌ 管理员登录失败: 用户名或密码错误`, 'error');
                    }
                } else {
                    // 验证学生和教师账号
                    const users = loadUsers();
                    const user = users.find(u => 
                        u.username === username && 
                        u.password === password && 
                        u.role === role && 
                        u.status === 'active'
                    );
                    
                    if (user) {
                        addTestResult(`✅ ${role === 'student' ? '学生' : '教师'}登录成功: ${user.realName}`, 'success');
                        sessionStorage.setItem('currentUser', JSON.stringify(user));
                    } else {
                        addTestResult(`❌ ${role === 'student' ? '学生' : '教师'}登录失败: 账号不存在或已禁用`, 'error');
                    }
                }
            }, 500);
        }

        // 从localStorage加载用户数据
        function loadUsers() {
            const savedUsers = localStorage.getItem('admin_users');
            if (savedUsers) {
                return JSON.parse(savedUsers);
            }
            // 返回默认用户数据
            return [
                {
                    id: 1,
                    username: 'student1',
                    password: '123456',
                    realName: '张三',
                    email: 'student1@demo.com',
                    phone: '13800138001',
                    role: 'student',
                    status: 'active',
                    grade: 'grade3'
                },
                {
                    id: 2,
                    username: 'student2',
                    password: '123456',
                    realName: '李四',
                    email: 'student2@demo.com',
                    phone: '13800138002',
                    role: 'student',
                    status: 'active',
                    grade: 'grade4'
                },
                {
                    id: 3,
                    username: 'teacher1',
                    password: '123456',
                    realName: '王老师',
                    email: 'teacher1@demo.com',
                    phone: '13800138003',
                    role: 'teacher',
                    status: 'active'
                },
                {
                    id: 4,
                    username: 'teacher2',
                    password: '123456',
                    realName: '李老师',
                    email: 'teacher2@demo.com',
                    phone: '13800138004',
                    role: 'teacher',
                    status: 'active'
                }
            ];
        }

        // 检查localStorage状态
        function checkLocalStorage() {
            const users = localStorage.getItem('admin_users');
            if (users) {
                const userCount = JSON.parse(users).length;
                addTestResult(`📊 localStorage中有 ${userCount} 个用户数据`, 'success');
            } else {
                addTestResult(`⚠️ localStorage中没有用户数据，将使用默认数据`, 'warning');
            }
        }

        // 检查sessionStorage状态
        function checkSessionStorage() {
            const currentUser = sessionStorage.getItem('currentUser');
            if (currentUser) {
                const user = JSON.parse(currentUser);
                addTestResult(`👤 当前登录用户: ${user.realName} (${user.role})`, 'success');
            } else {
                addTestResult(`ℹ️ 当前没有登录用户`, 'info');
            }
        }

        // 清除所有数据
        function clearAllData() {
            if (confirm('确定要清除所有数据吗？这将重置系统到初始状态。')) {
                localStorage.clear();
                sessionStorage.clear();
                addTestResult(`🗑️ 已清除所有本地数据`, 'warning');
                
                // 重新初始化默认用户数据
                setTimeout(() => {
                    const defaultUsers = loadUsers();
                    localStorage.setItem('admin_users', JSON.stringify(defaultUsers));
                    addTestResult(`🔄 已重新初始化默认用户数据`, 'success');
                }, 1000);
            }
        }

        // 页面加载时自动检查
        window.addEventListener('load', function() {
            addTestResult('🚀 登录测试页面已加载', 'info');
            checkLocalStorage();
            checkSessionStorage();
        });
    </script>
</body>
</html> 