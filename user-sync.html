<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äº‘å·¥åŠ - ç”¨æˆ·æ•°æ®åŒæ­¥</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="max-w-6xl mx-auto p-8">
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-900 mb-4">ğŸ”„ äº‘å·¥åŠ - ç”¨æˆ·æ•°æ®åŒæ­¥</h1>
            <p class="text-gray-600">åœ¨ä¸åŒç”µè„‘é—´åŒæ­¥ç”¨æˆ·æ•°æ®ï¼Œç¡®ä¿æ‰€æœ‰è®¾å¤‡éƒ½èƒ½ä½¿ç”¨ç®¡ç†å‘˜æ·»åŠ çš„è´¦å·</p>
        </div>

        <!-- å½“å‰çŠ¶æ€ -->
        <div class="bg-white rounded-lg shadow-sm border p-6 mb-8">
            <h2 class="text-xl font-semibold text-gray-900 mb-4">ğŸ“Š å½“å‰æ•°æ®çŠ¶æ€</h2>
            <div id="current-status" class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="p-4 bg-blue-50 rounded-lg border border-blue-200">
                    <div class="text-sm font-medium text-blue-900">æœ¬åœ°ç”¨æˆ·æ•°æ®</div>
                    <div id="local-users-count" class="text-2xl font-bold text-blue-600">æ£€æŸ¥ä¸­...</div>
                    <div class="text-xs text-blue-700">å½“å‰ç”µè„‘å­˜å‚¨çš„ç”¨æˆ·æ•°é‡</div>
                </div>
                <div class="p-4 bg-green-50 rounded-lg border border-green-200">
                    <div class="text-sm font-medium text-green-900">é»˜è®¤ç”¨æˆ·</div>
                    <div class="text-2xl font-bold text-green-600">4</div>
                    <div class="text-xs text-green-700">ç³»ç»Ÿé»˜è®¤æ¼”ç¤ºç”¨æˆ·</div>
                </div>
                <div class="p-4 bg-purple-50 rounded-lg border border-purple-200">
                    <div class="text-sm font-medium text-purple-900">ç®¡ç†å‘˜æ·»åŠ </div>
                    <div id="admin-added-count" class="text-2xl font-bold text-purple-600">è®¡ç®—ä¸­...</div>
                    <div class="text-xs text-purple-700">ç®¡ç†å‘˜é¢å¤–æ·»åŠ çš„ç”¨æˆ·</div>
                </div>
            </div>
        </div>

        <!-- åŒæ­¥æ“ä½œ -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
            <!-- å¯¼å‡ºæ•°æ® -->
            <div class="bg-white rounded-lg shadow-sm border p-6">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">ğŸ“¤ å¯¼å‡ºç”¨æˆ·æ•°æ®</h3>
                <p class="text-gray-600 mb-4">å°†å½“å‰ç”µè„‘çš„æ‰€æœ‰ç”¨æˆ·æ•°æ®å¯¼å‡ºä¸ºæ–‡ä»¶ï¼Œå¯ä»¥åˆ†äº«ç»™å…¶ä»–ç”µè„‘ä½¿ç”¨ã€‚</p>
                
                <div class="space-y-4">
                    <div class="p-4 bg-gray-50 rounded-lg">
                        <div class="text-sm font-medium text-gray-900 mb-2">å¯¼å‡ºå†…å®¹ï¼š</div>
                        <ul class="text-sm text-gray-600 space-y-1">
                            <li>â€¢ æ‰€æœ‰ç”¨æˆ·ä¿¡æ¯ï¼ˆå­¦ç”Ÿã€æ•™å¸ˆï¼‰</li>
                            <li>â€¢ ç”¨æˆ·å¯†ç å’ŒçŠ¶æ€</li>
                            <li>â€¢ æ³¨å†Œæ—¶é—´å’Œæœ€åç™»å½•æ—¶é—´</li>
                            <li>â€¢ å¯¼å‡ºæ—¶é—´å’Œç‰ˆæœ¬ä¿¡æ¯</li>
                        </ul>
                    </div>
                    
                    <button onclick="exportUserData()" class="w-full bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-medium transition-colors flex items-center justify-center">
                        <i data-lucide="download" class="h-5 w-5 mr-2"></i>
                        å¯¼å‡ºç”¨æˆ·æ•°æ®
                    </button>
                </div>
            </div>

            <!-- å¯¼å…¥æ•°æ® -->
            <div class="bg-white rounded-lg shadow-sm border p-6">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">ğŸ“¥ å¯¼å…¥ç”¨æˆ·æ•°æ®</h3>
                <p class="text-gray-600 mb-4">ä»å…¶ä»–ç”µè„‘å¯¼å‡ºçš„ç”¨æˆ·æ•°æ®æ–‡ä»¶å¯¼å…¥åˆ°å½“å‰ç”µè„‘ã€‚</p>
                
                <div class="space-y-4">
                    <div class="p-4 bg-gray-50 rounded-lg">
                        <div class="text-sm font-medium text-gray-900 mb-2">å¯¼å…¥è¯´æ˜ï¼š</div>
                        <ul class="text-sm text-gray-600 space-y-1">
                            <li>â€¢ æ”¯æŒJSONæ ¼å¼çš„ç”¨æˆ·æ•°æ®æ–‡ä»¶</li>
                            <li>â€¢ è‡ªåŠ¨åˆå¹¶æ–°ç”¨æˆ·ï¼Œé¿å…é‡å¤</li>
                            <li>â€¢ ä¿ç•™ç°æœ‰ç”¨æˆ·æ•°æ®</li>
                            <li>â€¢ è‡ªåŠ¨å¤„ç†ç”¨æˆ·IDå†²çª</li>
                        </ul>
                    </div>
                    
                    <button onclick="importUserData()" class="w-full bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium transition-colors flex items-center justify-center">
                        <i data-lucide="upload" class="h-5 w-5 mr-2"></i>
                        å¯¼å…¥ç”¨æˆ·æ•°æ®
                    </button>
                </div>
            </div>
        </div>

        <!-- ä½¿ç”¨è¯´æ˜ -->
        <div class="bg-white rounded-lg shadow-sm border p-6 mb-8">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">ğŸ“‹ ä½¿ç”¨è¯´æ˜</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <h4 class="font-medium text-gray-900 mb-2">ğŸ–¥ï¸ åœ¨ç®¡ç†å‘˜ç”µè„‘ä¸Šï¼š</h4>
                    <ol class="text-sm text-gray-600 space-y-1 list-decimal list-inside">
                        <li>æ·»åŠ æ–°ç”¨æˆ·åï¼Œç‚¹å‡»"å¯¼å‡ºç”¨æˆ·æ•°æ®"</li>
                        <li>ä¿å­˜å¯¼å‡ºçš„JSONæ–‡ä»¶</li>
                        <li>å°†æ–‡ä»¶åˆ†äº«ç»™å…¶ä»–ç”µè„‘ï¼ˆUç›˜ã€ç½‘ç›˜ç­‰ï¼‰</li>
                    </ol>
                </div>
                <div>
                    <h4 class="font-medium text-gray-900 mb-2">ğŸ’» åœ¨å…¶ä»–ç”µè„‘ä¸Šï¼š</h4>
                    <ol class="text-sm text-gray-600 space-y-1 list-decimal list-inside">
                        <li>æ‰“å¼€æ­¤åŒæ­¥é¡µé¢</li>
                        <li>ç‚¹å‡»"å¯¼å…¥ç”¨æˆ·æ•°æ®"</li>
                        <li>é€‰æ‹©ä»ç®¡ç†å‘˜ç”µè„‘å¯¼å‡ºçš„JSONæ–‡ä»¶</li>
                        <li>ç¡®è®¤å¯¼å…¥ï¼Œå³å¯ä½¿ç”¨æ–°è´¦å·ç™»å½•</li>
                    </ol>
                </div>
            </div>
        </div>

        <!-- ç”¨æˆ·åˆ—è¡¨é¢„è§ˆ -->
        <div class="bg-white rounded-lg shadow-sm border p-6 mb-8">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">ğŸ‘¥ å½“å‰ç”¨æˆ·åˆ—è¡¨</h3>
            <div id="users-preview" class="space-y-2">
                <div class="text-gray-500">åŠ è½½ä¸­...</div>
            </div>
        </div>

        <!-- æ“ä½œæŒ‰é’® -->
        <div class="text-center space-x-4">
            <a href="admin-users.html" class="inline-flex items-center px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors">
                <i data-lucide="users" class="h-5 w-5 mr-2"></i>
                ç”¨æˆ·ç®¡ç†
            </a>
            <a href="index.html" class="inline-flex items-center px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                <i data-lucide="log-in" class="h-5 w-5 mr-2"></i>
                ç™»å½•é¡µé¢
            </a>
            <a href="navigation.html" class="inline-flex items-center px-6 py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors">
                <i data-lucide="navigation" class="h-5 w-5 mr-2"></i>
                å¯¼èˆªä¸­å¿ƒ
            </a>
        </div>
    </div>

    <script>
        // åˆå§‹åŒ–Lucideå›¾æ ‡
        lucide.createIcons();

        // ä»localStorageåŠ è½½ç”¨æˆ·æ•°æ®
        function loadUsers() {
            const savedUsers = localStorage.getItem('admin_users');
            if (savedUsers) {
                try {
                    return JSON.parse(savedUsers);
                } catch (error) {
                    console.error('è§£æç”¨æˆ·æ•°æ®å¤±è´¥:', error);
                    return [];
                }
            }
            return [];
        }

        // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
        function updateStatus() {
            const users = loadUsers();
            const defaultUsers = 4; // é»˜è®¤ç”¨æˆ·æ•°é‡
            const adminAdded = Math.max(0, users.length - defaultUsers);
            
            document.getElementById('local-users-count').textContent = users.length;
            document.getElementById('admin-added-count').textContent = adminAdded;
            
            // æ›´æ–°ç”¨æˆ·åˆ—è¡¨é¢„è§ˆ
            showUsersPreview(users);
        }

        // æ˜¾ç¤ºç”¨æˆ·åˆ—è¡¨é¢„è§ˆ
        function showUsersPreview(users) {
            const previewDiv = document.getElementById('users-preview');
            
            if (users.length === 0) {
                previewDiv.innerHTML = '<div class="text-gray-500">æš‚æ— ç”¨æˆ·æ•°æ®</div>';
                return;
            }
            
            previewDiv.innerHTML = users.map(user => `
                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                    <div class="flex items-center space-x-3">
                        <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
                            <span class="text-xs font-medium text-blue-600">${user.realName ? user.realName.charAt(0) : user.username.charAt(0)}</span>
                        </div>
                        <div>
                            <div class="text-sm font-medium text-gray-900">${user.realName}</div>
                            <div class="text-xs text-gray-500">${user.username}</div>
                        </div>
                    </div>
                    <div class="flex items-center space-x-2">
                        <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full ${
                            user.role === 'student' ? 'bg-blue-100 text-blue-800' :
                            user.role === 'teacher' ? 'bg-green-100 text-green-800' :
                            'bg-purple-100 text-purple-800'
                        }">
                            ${user.role === 'student' ? 'å­¦ç”Ÿ' : user.role === 'teacher' ? 'æ•™å¸ˆ' : 'ç®¡ç†å‘˜'}
                        </span>
                        <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full ${
                            user.status === 'active' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'
                        }">
                            ${user.status === 'active' ? 'æ­£å¸¸' : 'ç¦ç”¨'}
                        </span>
                    </div>
                </div>
            `).join('');
        }

        // å¯¼å‡ºç”¨æˆ·æ•°æ®
        function exportUserData() {
            try {
                const users = loadUsers();
                
                if (users.length === 0) {
                    alert('âŒ æ²¡æœ‰ç”¨æˆ·æ•°æ®å¯å¯¼å‡º');
                    return;
                }
                
                const exportData = {
                    version: '1.0',
                    exportTime: new Date().toISOString(),
                    users: users,
                    totalCount: users.length,
                    description: 'äº‘å·¥åŠç”¨æˆ·æ•°æ®å¯¼å‡ºæ–‡ä»¶'
                };
                
                const dataStr = JSON.stringify(exportData, null, 2);
                const blob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `äº‘å·¥åŠç”¨æˆ·æ•°æ®_${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                URL.revokeObjectURL(url);
                
                alert(`âœ… ç”¨æˆ·æ•°æ®å¯¼å‡ºæˆåŠŸï¼\n\nå¯¼å‡ºæ–‡ä»¶ï¼šäº‘å·¥åŠç”¨æˆ·æ•°æ®_${new Date().toISOString().split('T')[0]}.json\nç”¨æˆ·æ•°é‡ï¼š${users.length}ä¸ª\n\nè¯·å°†æ­¤æ–‡ä»¶åˆ†äº«ç»™å…¶ä»–ç”µè„‘ä½¿ç”¨ã€‚`);
                
            } catch (error) {
                alert(`âŒ å¯¼å‡ºå¤±è´¥ï¼š${error.message}`);
            }
        }

        // å¯¼å…¥ç”¨æˆ·æ•°æ®
        function importUserData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const importData = JSON.parse(e.target.result);
                        
                        if (!importData.users || !Array.isArray(importData.users)) {
                            throw new Error('æ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®ï¼Œç¼ºå°‘ç”¨æˆ·æ•°æ®');
                        }
                        
                        if (importData.users.length === 0) {
                            throw new Error('å¯¼å…¥æ–‡ä»¶ä¸­æ²¡æœ‰ç”¨æˆ·æ•°æ®');
                        }
                        
                        if (confirm(`ç¡®å®šè¦å¯¼å…¥ç”¨æˆ·æ•°æ®å—ï¼Ÿ\n\næ–‡ä»¶ä¿¡æ¯ï¼š\n- ç”¨æˆ·æ•°é‡ï¼š${importData.users.length}ä¸ª\n- å¯¼å‡ºæ—¶é—´ï¼š${importData.exportTime}\n- æ–‡ä»¶æè¿°ï¼š${importData.description || 'æ— '}\n\nè¿™å°†åˆå¹¶åˆ°å½“å‰ç”¨æˆ·æ•°æ®ä¸­ã€‚`)) {
                            
                            // è·å–ç°æœ‰ç”¨æˆ·
                            const existingUsers = loadUsers();
                            const existingUsernames = new Set(existingUsers.map(u => u.username));
                            
                            // è¿‡æ»¤æ–°ç”¨æˆ·ï¼ˆé¿å…ç”¨æˆ·åé‡å¤ï¼‰
                            const newUsers = importData.users.filter(user => !existingUsernames.has(user.username));
                            
                            if (newUsers.length === 0) {
                                alert('âš ï¸ æ‰€æœ‰ç”¨æˆ·éƒ½å·²å­˜åœ¨ï¼Œæ²¡æœ‰æ–°ç”¨æˆ·éœ€è¦å¯¼å…¥');
                                return;
                            }
                            
                            // å¤„ç†IDå†²çª
                            const maxId = Math.max(...existingUsers.map(u => u.id), 0);
                            newUsers.forEach((user, index) => {
                                user.id = maxId + index + 1;
                            });
                            
                            // åˆå¹¶ç”¨æˆ·æ•°æ®
                            const mergedUsers = [...existingUsers, ...newUsers];
                            localStorage.setItem('admin_users', JSON.stringify(mergedUsers));
                            
                            // æ›´æ–°æ˜¾ç¤º
                            updateStatus();
                            
                            alert(`âœ… ç”¨æˆ·æ•°æ®å¯¼å…¥æˆåŠŸï¼\n\nå¯¼å…¥æ–°ç”¨æˆ·ï¼š${newUsers.length}ä¸ª\nè·³è¿‡é‡å¤ç”¨æˆ·ï¼š${importData.users.length - newUsers.length}ä¸ª\nå½“å‰æ€»ç”¨æˆ·ï¼š${mergedUsers.length}ä¸ª`);
                        }
                    } catch (error) {
                        alert(`âŒ å¯¼å…¥å¤±è´¥ï¼š${error.message}`);
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.addEventListener('load', function() {
            updateStatus();
        });
    </script>
</body>
</html> 